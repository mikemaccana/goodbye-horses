<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="../public/css/reset.css"/>
		<link rel="stylesheet/less" type="text/css" href="../public/less/portfolio.less">
		<script src="../public/js/less-1.2.1.min.js" type="text/javascript"></script>
		<script src="../public/js/jquery.js"></script>
		<script src="../public/js/jquery.color.js"></script>
		<script src="../public/js/jquery.quicksand.js"></script>
		<script src="../public/js/icanhas.min.js"></script>
		
		<script id="portfolio_template" type="text/html">
			<header>
				<div id="header_and_slogan">
					<h1>{{name}}</h1>
					<p class="slogan">&mdash;{{ slogan }}</a>
				</div>	
				<address>
					<a class="email" href="mailto:{{ email }}">{{ email }}</a><br> 
					<a class="twitter" href="https://twitter.com/{{ twitter }}">@{{ twitter }}</a>
				</address>
				<div class="clearfix"></div>
			</header>
			<nav>
				<ul>
					<li><a href="writing">Writing</a></li>
					<li><a href="work">Work</a></li>
					<li><a href="art">Art</a></li>
					<li><a href="contact">Contact</a></li>
				</ul>
				<div class="clearfix"></div>
			</nav>
			
			<section class="maincontent">
				<section class="main">
					{{# articles}}
						<article>
							<h2>{{ title }}</h2>
							<time datetime="{{ publication_date }}" pubdate>{{ publication_date }}</time>
							<p>{{ body }}</p>
						</article>
					{{/articles}}
				</section>
				<section class="sidebar">
					<p class="bio">{{ bio }}</a>	
				</section>
			</section>
			
			<section class="maincontent">
				<ul id="works">
					{{# works}}
						<li data-id="{{ slug_name }}" class="work">
							<img src="http://lorempixel.com/240/135/"></src>
							<h2>{{ name }}</h2>
							<div class="year">{{ year }}</div>
							<div class="clearfix"></div>
							<p class="description">{{ description }}</a>
							<ul>
								{{# tags}}
									<li class="tag">{{ . }}</li>
								{{/tags}}
							</ul>
							{{#github}}<a href="http://www.github.com/mikemaccana/{{ github }}" class="github" target="_blank">On github &#0187;</a>{{/github}}
						</li>
					{{/works}}
				</ul>
				<div class="clearfix"></div>
			</section>
			<ul id="sorted_works">
			</ul>
			<footer>
				<h2>Contact</h2>
				<a class="email" href="mailto:{{ email }}">{{ email }}</a>
				<a class="twitter" href="https://twitter.com/{{ twitter }}">@{{ twitter }}</a>
			</footer>
		</script>
		
		<script id="sorted_works_template" type="text/html">
			<ul id="sorted_works" class="hidden">
				{{# works }}
					<li data-id="{{ slug_name }}" class="work">
					
					<img src="http://lorempixel.com/240/135/"></src>
					<h2>{{ name }}</h2>
					<div class="year">{{ year }}</div>
					<div class="clearfix"></div>
					<p class="description">{{ description }}</a>
						<ul>
							{{# tags}}
								<li class="tag">{{ . }}</li>
							{{/tags}}
						</ul>				
					</li>
				{{/works}}
			</ul>
		</script>
		
		<script>
			$(function(){
			
				// Fetch and fill in the portfolio
				$.getJSON('../public/json/portfolio.json', function(portfolio_data) {
					
					console.log('we have data')
					console.log(portfolio_data)
					
					portfolio_data.works.forEach( function(work) {
						work['slug_name'] = work.name.replace(/[\s-,']+/g, '').toLowerCase()
					}) 

					var portfolio = ich.portfolio_template(portfolio_data);
					$('body').append(portfolio);
			
					var sort_works = function(sort_key) {
						// Return a list of the work with the tag/sort_key mentioned
						var sorted_works = [];
						portfolio_data.works.forEach(function(work) {
							if ( work.tags.indexOf(sort_key)+1 ) {
								sorted_works.push(work);
							}
						})
						return sorted_works					
					};
				
					var enable_tags = function(event){	
						// Sort works when tags clicked 
						console.log('Tag clicked')
						var sort_key = $(event.target).text();
				
						sorted_works = {
							works: sort_works(sort_key)
						}
				
						var sorted_portfolio = ich.sorted_works_template(sorted_works);
						$('#sorted_works').replaceWith(sorted_portfolio);
				
						$('#works').quicksand( $('#sorted_works li.work') );
					};
					
					$('#works > li > ul > li.tag').live('click', enable_tags);
					$('#works > li > ul > li.tag').live("mouseenter", function() {
						$(event.target).animate({ backgroundColor: "#222" }, 'slow');
					}).live("mouseleave", function() {
						$(event.target).animate({ backgroundColor: "#777" }, 'slow');
					});
					
				})
				
			
				
				
			})
		
			console.log('hello');
			$(document).on('click', 'nav > ul > li > a', function(event) {
				var $target = $(event.target);
				var destination = $target.attr('href');
				var title = $target.text();
				$.get(destination, function() {
					history.pushState({}, title, destination);	
					$('section').fadeOut();
					event.preventDefault();	
				})
			});
			
			console.log('set up handler');
			
		
		</script>
		
	</head>
	<body>
	</body>	
</html>